2025-10-31 18:48:20,715 - __main__ - INFO - ================================================================================
2025-10-31 18:48:20,715 - __main__ - INFO - ADHD DIGITAL PHENOTYPE ANALYSIS PIPELINE
2025-10-31 18:48:20,715 - __main__ - INFO - Started at: 2025-10-31 18:48:20
2025-10-31 18:48:20,715 - __main__ - INFO - ================================================================================
2025-10-31 18:48:20,715 - __main__ - INFO - 
================================================================================
2025-10-31 18:48:20,715 - __main__ - INFO - PHASE 0: DATA LOADING AND PREPARATION
2025-10-31 18:48:20,715 - __main__ - INFO - ================================================================================
2025-10-31 18:48:20,715 - data_loader - INFO - ================================================================================
2025-10-31 18:48:20,715 - data_loader - INFO - Starting data loading and preparation
2025-10-31 18:48:20,715 - data_loader - INFO - ================================================================================
2025-10-31 18:48:20,715 - data_loader - INFO - Loading Fitbit data from /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/fitbit_data.xlsx
2025-10-31 18:48:20,812 - data_loader - INFO - Found 14 sheets: ['NC Controls', 'ADHD_preprocessed', 'ADHD_Unmedicated', 'ADHD_Stimulants', 'ADHD_NonStimulants', 'ABCD_Methylphenidate_only', 'ADHD_Amphetamine_Only', 'ADHD_Lisdexamfetamine_Only', 'ADHD_Guanfacine_Only', 'ADHD_Atomoxetine_Only', 'ADHD_Dexmethylphenidate_Only', 'HR_explained', 'ADHD_OLD', 'ADHD_Medicated_OLD']
2025-10-31 18:48:20,812 - data_loader - INFO - Loading sheet: NC Controls
2025-10-31 18:48:23,167 - data_loader - INFO -   Assigned as Control group: 2238 subjects
2025-10-31 18:48:23,167 - data_loader - INFO - Loading sheet: ADHD_preprocessed
2025-10-31 18:48:23,450 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_preprocessed', defaulting to control
2025-10-31 18:48:23,450 - data_loader - INFO - Loading sheet: ADHD_Unmedicated
2025-10-31 18:48:23,584 - data_loader - INFO -   Assigned as Unmedicated ADHD: 143 subjects
2025-10-31 18:48:23,584 - data_loader - INFO - Loading sheet: ADHD_Stimulants
2025-10-31 18:48:23,727 - data_loader - INFO -   Assigned as Stimulant ADHD: 110 subjects
2025-10-31 18:48:23,728 - data_loader - INFO - Loading sheet: ADHD_NonStimulants
2025-10-31 18:48:23,774 - data_loader - INFO -   Assigned as Stimulant ADHD: 15 subjects
2025-10-31 18:48:23,775 - data_loader - INFO - Loading sheet: ABCD_Methylphenidate_only
2025-10-31 18:48:23,806 - data_loader - WARNING -   Could not determine group for sheet 'ABCD_Methylphenidate_only', defaulting to control
2025-10-31 18:48:23,806 - data_loader - INFO - Loading sheet: ADHD_Amphetamine_Only
2025-10-31 18:48:23,836 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Amphetamine_Only', defaulting to control
2025-10-31 18:48:23,837 - data_loader - INFO - Loading sheet: ADHD_Lisdexamfetamine_Only
2025-10-31 18:48:23,869 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Lisdexamfetamine_Only', defaulting to control
2025-10-31 18:48:23,870 - data_loader - INFO - Loading sheet: ADHD_Guanfacine_Only
2025-10-31 18:48:23,901 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Guanfacine_Only', defaulting to control
2025-10-31 18:48:23,901 - data_loader - INFO - Loading sheet: ADHD_Atomoxetine_Only
2025-10-31 18:48:23,932 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Atomoxetine_Only', defaulting to control
2025-10-31 18:48:23,932 - data_loader - INFO - Loading sheet: ADHD_Dexmethylphenidate_Only
2025-10-31 18:48:24,007 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Dexmethylphenidate_Only', defaulting to control
2025-10-31 18:48:24,007 - data_loader - INFO - Loading sheet: HR_explained
2025-10-31 18:48:24,038 - data_loader - WARNING -   Could not determine group for sheet 'HR_explained', defaulting to control
2025-10-31 18:48:24,038 - data_loader - INFO - Loading sheet: ADHD_OLD
2025-10-31 18:48:24,100 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_OLD', defaulting to control
2025-10-31 18:48:24,100 - data_loader - INFO - Loading sheet: ADHD_Medicated_OLD
2025-10-31 18:48:24,143 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Medicated_OLD', defaulting to control
2025-10-31 18:48:24,163 - data_loader - INFO - Successfully loaded 3404 total rows from 14 sheets
2025-10-31 18:48:24,164 - data_loader - INFO - Group distribution after loading:
2025-10-31 18:48:24,164 - data_loader - INFO -   Healthy Control: 3136
2025-10-31 18:48:24,164 - data_loader - INFO -   ADHD Unmedicated: 143
2025-10-31 18:48:24,164 - data_loader - INFO -   ADHD Stimulant: 125
2025-10-31 18:48:24,164 - data_loader - INFO - Loading medication data from /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/medsy01.xlsx
2025-10-31 18:48:34,156 - data_loader - INFO - Successfully loaded 39766 medication records
2025-10-31 18:48:34,156 - data_loader - INFO - Creating medication group classifications
2025-10-31 18:48:39,892 - data_loader - INFO - Medication groups: {'none': 36749, 'stimulant': 3017}
2025-10-31 18:48:39,941 - data_loader - INFO - Merging datasets and creating analysis groups
2025-10-31 18:48:39,966 - data_loader - WARNING - No 'adhd_diagnosis' column found. Inferring groups from medication only.
2025-10-31 18:48:39,967 - data_loader - INFO - Analysis group distribution:
2025-10-31 18:48:39,967 - data_loader - INFO -   Healthy Control: 10701
2025-10-31 18:48:39,967 - data_loader - INFO -   ADHD Stimulant: 414
2025-10-31 18:48:39,967 - data_loader - INFO - Preparing covariates
2025-10-31 18:48:39,970 - data_loader - WARNING - Missing covariates: ['interview_age', 'sex', 'family_income', 'race_eth_cat']
2025-10-31 18:48:39,970 - data_loader - INFO - Found 125 available Fitbit features
2025-10-31 18:48:39,970 - utils - INFO - Performing data quality checks...
2025-10-31 18:48:40,045 - utils - INFO - Data quality check complete. Total subjects: 11115
2025-10-31 18:48:40,045 - utils - INFO - Features with high missing rate: 0
2025-10-31 18:48:40,045 - utils - INFO - Handling missing values using method: drop
2025-10-31 18:48:40,052 - utils - INFO - Dropped rows with missing values. Remaining: 10513
2025-10-31 18:48:40,052 - data_loader - INFO - ================================================================================
2025-10-31 18:48:40,052 - data_loader - INFO - Data preparation complete. Final dataset: 10513 subjects
2025-10-31 18:48:40,052 - data_loader - INFO - ================================================================================
2025-10-31 18:48:40,062 - __main__ - INFO - Loaded dataset: 10513 subjects, 125 features
2025-10-31 18:48:40,062 - __main__ - INFO - Found 2 groups for analysis
2025-10-31 18:48:40,062 - utils - INFO - Performing data quality checks...
2025-10-31 18:48:40,177 - utils - INFO - Data quality check complete. Total subjects: 10513
2025-10-31 18:48:40,177 - utils - INFO - Features with high missing rate: 0
2025-10-31 18:48:40,177 - residualization - INFO - ================================================================================
2025-10-31 18:48:40,177 - residualization - INFO - PHASE 1: RESIDUALIZATION - Removing Covariate Effects
2025-10-31 18:48:40,177 - residualization - INFO - ================================================================================
2025-10-31 18:48:40,182 - residualization - INFO - Using 10099 healthy controls for regression models
2025-10-31 18:48:40,182 - residualization - WARNING - Covariate interview_age not found in dataframe
2025-10-31 18:48:40,182 - residualization - WARNING - Covariate family_income not found in dataframe
2025-10-31 18:48:40,182 - residualization - INFO - Using 0 covariate columns: []
2025-10-31 18:48:40,183 - residualization - INFO - Residualizing 125 features...
2025-10-31 18:48:40,283 - residualization - INFO - Progress: 50/125 features processed
2025-10-31 18:48:40,378 - residualization - INFO - Progress: 100/125 features processed
2025-10-31 18:48:40,438 - residualization - INFO - ================================================================================
2025-10-31 18:48:40,438 - residualization - INFO - Residualization complete:
2025-10-31 18:48:40,438 - residualization - INFO -   Successful: 125 features
2025-10-31 18:48:40,438 - residualization - INFO -   Failed: 0 features
2025-10-31 18:48:40,438 - residualization - INFO - ================================================================================
2025-10-31 18:48:40,444 - residualization - INFO - Residualization statistics saved to residualization_statistics.csv
2025-10-31 18:48:40,444 - residualization - INFO - Validating residualization effectiveness...
2025-10-31 18:48:40,444 - residualization - WARNING - Covariate interview_age not available for validation
2025-10-31 18:48:41,172 - __main__ - INFO - Residualized data saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/residualized_data.csv
2025-10-31 18:48:41,176 - __main__ - INFO - 
Running predictive models with 125 features
2025-10-31 18:48:41,176 - __main__ - WARNING - Group unmedicated_adhd not found in data. Skipping comparison.
2025-10-31 18:48:41,176 - predictive_models - INFO - ================================================================================
2025-10-31 18:48:41,176 - predictive_models - INFO - PHASE 2: PREDICTIVE MODELING
2025-10-31 18:48:41,176 - predictive_models - INFO - Comparing: Healthy Control vs ADHD Stimulant
2025-10-31 18:48:41,176 - predictive_models - INFO - ================================================================================
2025-10-31 18:48:41,176 - predictive_models - INFO - Preparing data for comparison: Group 0 vs Group 2
2025-10-31 18:48:41,187 - predictive_models - INFO - Data prepared: 10513 samples, 125 features
2025-10-31 18:48:41,187 - predictive_models - INFO -   Group 0: 10099 samples
2025-10-31 18:48:41,187 - predictive_models - INFO -   Group 2: 414 samples
2025-10-31 18:48:41,187 - predictive_models - INFO - Class distribution: {0: 10099, 1: 414}
2025-10-31 18:48:41,191 - predictive_models - INFO - Train set: 7359 samples, Test set: 3154 samples
2025-10-31 18:48:41,191 - predictive_models - INFO - Training Logistic Regression model...
2025-10-31 18:48:41,652 - predictive_models - INFO - Logistic Regression Results:
2025-10-31 18:48:41,652 - predictive_models - INFO -   Accuracy: 0.7435
2025-10-31 18:48:41,652 - predictive_models - INFO -   ROC-AUC: 0.8015
2025-10-31 18:48:41,652 - predictive_models - INFO -   CV ROC-AUC: 0.7878 (+/- 0.0281)
2025-10-31 18:48:41,652 - predictive_models - INFO -   Precision: 0.1050
2025-10-31 18:48:41,653 - predictive_models - INFO -   Recall: 0.7339
2025-10-31 18:48:41,653 - predictive_models - INFO -   F1-Score: 0.1837
2025-10-31 18:48:41,653 - predictive_models - INFO - Training Random Forest model...
2025-10-31 18:48:43,532 - predictive_models - INFO - Random Forest Results:
2025-10-31 18:48:43,532 - predictive_models - INFO -   Accuracy: 0.9658
2025-10-31 18:48:43,532 - predictive_models - INFO -   ROC-AUC: 0.9576
2025-10-31 18:48:43,533 - predictive_models - INFO -   CV ROC-AUC: 0.8779 (+/- 0.0413)
2025-10-31 18:48:43,533 - predictive_models - INFO -   Precision: 0.5408
2025-10-31 18:48:43,533 - predictive_models - INFO -   Recall: 0.8548
2025-10-31 18:48:43,533 - predictive_models - INFO -   F1-Score: 0.6625
2025-10-31 18:48:43,533 - predictive_models - INFO - 
================================================================================
2025-10-31 18:48:43,533 - predictive_models - INFO - MODEL COMPARISON SUMMARY
2025-10-31 18:48:43,533 - predictive_models - INFO - ================================================================================
2025-10-31 18:48:43,533 - predictive_models - INFO - Metric               Logistic Reg    Random Forest  
2025-10-31 18:48:43,533 - predictive_models - INFO - --------------------------------------------------------------------------------
2025-10-31 18:48:43,533 - predictive_models - INFO - Accuracy             0.7435          0.9658         
2025-10-31 18:48:43,533 - predictive_models - INFO - ROC-AUC              0.8015          0.9576         
2025-10-31 18:48:43,533 - predictive_models - INFO - Precision            0.1050          0.5408         
2025-10-31 18:48:43,533 - predictive_models - INFO - Recall               0.7339          0.8548         
2025-10-31 18:48:43,533 - predictive_models - INFO - F1-Score             0.1837          0.6625         
2025-10-31 18:48:43,533 - predictive_models - INFO - ================================================================================
2025-10-31 18:48:43,533 - predictive_models - INFO - Creating visualization plots...
2025-10-31 18:48:44,783 - predictive_models - INFO - Plots saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/model_Healthy Control_vs_ADHD Stimulant_results.png
2025-10-31 18:48:44,785 - __main__ - INFO - Results saved for comparison: Healthy Control_vs_ADHD Stimulant
2025-10-31 18:48:44,785 - __main__ - WARNING - Group unmedicated_adhd not found in data. Skipping comparison.
2025-10-31 18:48:44,785 - visualization - INFO - ================================================================================
2025-10-31 18:48:44,785 - visualization - INFO - PHASE 3: PCA ANALYSIS - Visualizing Digital Phenotypes
2025-10-31 18:48:44,786 - visualization - INFO - ================================================================================
2025-10-31 18:48:44,786 - visualization - INFO - Performing PCA with 10 components...
2025-10-31 18:48:44,816 - visualization - INFO - PCA Results:
2025-10-31 18:48:44,816 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC3: 0.0958 variance (0.3859 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC4: 0.0834 variance (0.4693 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC5: 0.0571 variance (0.5264 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC6: 0.0406 variance (0.5669 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC7: 0.0377 variance (0.6047 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC8: 0.0318 variance (0.6365 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC9: 0.0274 variance (0.6639 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO -   PC10: 0.0269 variance (0.6908 cumulative)
2025-10-31 18:48:44,816 - visualization - INFO - Creating scree plot...
2025-10-31 18:48:45,084 - visualization - INFO - Scree plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_scree_plot.png
2025-10-31 18:48:45,084 - visualization - INFO - Performing PCA with 2 components...
2025-10-31 18:48:45,102 - visualization - INFO - PCA Results:
2025-10-31 18:48:45,102 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 18:48:45,102 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 18:48:45,102 - visualization - INFO - Creating 2D PCA plot...
2025-10-31 18:48:45,523 - visualization - INFO - 2D PCA plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_2d_plot.png
2025-10-31 18:48:45,523 - visualization - INFO - Performing PCA with 3 components...
2025-10-31 18:48:45,547 - visualization - INFO - PCA Results:
2025-10-31 18:48:45,547 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 18:48:45,547 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 18:48:45,547 - visualization - INFO -   PC3: 0.0958 variance (0.3859 cumulative)
2025-10-31 18:48:45,547 - visualization - INFO - Creating 3D PCA plot...
2025-10-31 18:48:46,112 - visualization - INFO - 3D PCA plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_3d_plot.png
2025-10-31 18:48:46,113 - visualization - INFO - Creating PCA loading heatmap...
2025-10-31 18:48:46,497 - visualization - INFO - Loading heatmap saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_loadings.png
2025-10-31 18:48:46,497 - visualization - INFO - Testing statistical significance of group separation...
2025-10-31 18:48:46,498 - visualization - INFO - PC1: F=12.3842, p=0.0004
2025-10-31 18:48:46,498 - visualization - INFO - PC2: F=0.0110, p=0.9164
2025-10-31 18:48:46,498 - visualization - INFO - ================================================================================
2025-10-31 18:48:46,498 - visualization - INFO - PCA Analysis Complete
2025-10-31 18:48:46,498 - visualization - INFO - ================================================================================
2025-10-31 18:48:46,499 - __main__ - INFO - 
================================================================================
2025-10-31 18:48:46,499 - __main__ - INFO - GENERATING SUMMARY REPORT
2025-10-31 18:48:46,499 - __main__ - INFO - ================================================================================
2025-10-31 18:48:46,499 - utils - INFO - Summary report created: /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/summary_report.txt
2025-10-31 18:48:46,500 - __main__ - ERROR - Pipeline execution failed: Object of type StandardScaler is not JSON serializable
Traceback (most recent call last):
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/main_pipeline.py", line 168, in main
    utils.save_results(summary_results, 'pipeline_results.json')
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/utils.py", line 371, in save_results
    json.dump(results_serializable, f, indent=2, cls=NumpyEncoder) # <-- Add cls=NumpyEncoder
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/__init__.py", line 179, in dump
    for chunk in iterable:
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 431, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  [Previous line repeated 1 more time]
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 438, in _iterencode
    o = _default(o)
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/utils.py", line 51, in default
    return super(NumpyEncoder, self).default(obj)
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type StandardScaler is not JSON serializable
2025-10-31 18:48:46,502 - __main__ - ERROR - Pipeline failed with error
2025-10-31 19:05:02,866 - __main__ - INFO - ================================================================================
2025-10-31 19:05:02,866 - __main__ - INFO - ADHD DIGITAL PHENOTYPE ANALYSIS PIPELINE
2025-10-31 19:05:02,866 - __main__ - INFO - Started at: 2025-10-31 19:05:02
2025-10-31 19:05:02,866 - __main__ - INFO - ================================================================================
2025-10-31 19:05:02,866 - __main__ - INFO - 
================================================================================
2025-10-31 19:05:02,866 - __main__ - INFO - PHASE 0: DATA LOADING AND PREPARATION
2025-10-31 19:05:02,866 - __main__ - INFO - ================================================================================
2025-10-31 19:05:02,866 - data_loader - INFO - ================================================================================
2025-10-31 19:05:02,866 - data_loader - INFO - Starting data loading and preparation
2025-10-31 19:05:02,866 - data_loader - INFO - ================================================================================
2025-10-31 19:05:02,867 - data_loader - INFO - Loading Fitbit data from /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/fitbit_data.xlsx
2025-10-31 19:05:02,952 - data_loader - INFO - Found 14 sheets: ['NC Controls', 'ADHD_preprocessed', 'ADHD_Unmedicated', 'ADHD_Stimulants', 'ADHD_NonStimulants', 'ABCD_Methylphenidate_only', 'ADHD_Amphetamine_Only', 'ADHD_Lisdexamfetamine_Only', 'ADHD_Guanfacine_Only', 'ADHD_Atomoxetine_Only', 'ADHD_Dexmethylphenidate_Only', 'HR_explained', 'ADHD_OLD', 'ADHD_Medicated_OLD']
2025-10-31 19:05:02,952 - data_loader - INFO - Loading sheet: NC Controls
2025-10-31 19:05:04,881 - data_loader - INFO -   Assigned as Control group: 2238 subjects
2025-10-31 19:05:04,881 - data_loader - INFO - Loading sheet: ADHD_preprocessed
2025-10-31 19:05:05,157 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_preprocessed', defaulting to control
2025-10-31 19:05:05,158 - data_loader - INFO - Loading sheet: ADHD_Unmedicated
2025-10-31 19:05:05,302 - data_loader - INFO -   Assigned as Unmedicated ADHD: 143 subjects
2025-10-31 19:05:05,303 - data_loader - INFO - Loading sheet: ADHD_Stimulants
2025-10-31 19:05:05,442 - data_loader - INFO -   Assigned as Stimulant ADHD: 110 subjects
2025-10-31 19:05:05,442 - data_loader - INFO - Loading sheet: ADHD_NonStimulants
2025-10-31 19:05:05,483 - data_loader - INFO -   Assigned as Stimulant ADHD: 15 subjects
2025-10-31 19:05:05,483 - data_loader - INFO - Loading sheet: ABCD_Methylphenidate_only
2025-10-31 19:05:05,514 - data_loader - WARNING -   Could not determine group for sheet 'ABCD_Methylphenidate_only', defaulting to control
2025-10-31 19:05:05,515 - data_loader - INFO - Loading sheet: ADHD_Amphetamine_Only
2025-10-31 19:05:05,543 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Amphetamine_Only', defaulting to control
2025-10-31 19:05:05,543 - data_loader - INFO - Loading sheet: ADHD_Lisdexamfetamine_Only
2025-10-31 19:05:05,572 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Lisdexamfetamine_Only', defaulting to control
2025-10-31 19:05:05,572 - data_loader - INFO - Loading sheet: ADHD_Guanfacine_Only
2025-10-31 19:05:05,600 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Guanfacine_Only', defaulting to control
2025-10-31 19:05:05,600 - data_loader - INFO - Loading sheet: ADHD_Atomoxetine_Only
2025-10-31 19:05:05,627 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Atomoxetine_Only', defaulting to control
2025-10-31 19:05:05,627 - data_loader - INFO - Loading sheet: ADHD_Dexmethylphenidate_Only
2025-10-31 19:05:05,695 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Dexmethylphenidate_Only', defaulting to control
2025-10-31 19:05:05,695 - data_loader - INFO - Loading sheet: HR_explained
2025-10-31 19:05:05,725 - data_loader - WARNING -   Could not determine group for sheet 'HR_explained', defaulting to control
2025-10-31 19:05:05,725 - data_loader - INFO - Loading sheet: ADHD_OLD
2025-10-31 19:05:05,790 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_OLD', defaulting to control
2025-10-31 19:05:05,790 - data_loader - INFO - Loading sheet: ADHD_Medicated_OLD
2025-10-31 19:05:05,830 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Medicated_OLD', defaulting to control
2025-10-31 19:05:05,850 - data_loader - INFO - Successfully loaded 3404 total rows from 14 sheets
2025-10-31 19:05:05,850 - data_loader - INFO - Group distribution after loading:
2025-10-31 19:05:05,850 - data_loader - INFO -   Healthy Control: 3136
2025-10-31 19:05:05,850 - data_loader - INFO -   ADHD Unmedicated: 143
2025-10-31 19:05:05,850 - data_loader - INFO -   ADHD Stimulant: 125
2025-10-31 19:05:05,850 - data_loader - INFO - Loading medication data from /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/medsy01.xlsx
2025-10-31 19:05:15,638 - data_loader - INFO - Successfully loaded 39766 medication records
2025-10-31 19:05:15,639 - data_loader - INFO - Creating medication group classifications
2025-10-31 19:05:21,273 - data_loader - INFO - Medication groups: {'none': 36749, 'stimulant': 3017}
2025-10-31 19:05:21,317 - data_loader - INFO - Merging datasets and creating analysis groups
2025-10-31 19:05:21,341 - data_loader - WARNING - No 'adhd_diagnosis' column found. Inferring groups from medication only.
2025-10-31 19:05:21,342 - data_loader - INFO - Analysis group distribution:
2025-10-31 19:05:21,342 - data_loader - INFO -   Healthy Control: 10701
2025-10-31 19:05:21,343 - data_loader - INFO -   ADHD Stimulant: 414
2025-10-31 19:05:21,343 - data_loader - INFO - Preparing covariates
2025-10-31 19:05:21,347 - data_loader - WARNING - Missing covariates: ['interview_age', 'sex', 'family_income', 'race_eth_cat']
2025-10-31 19:05:21,347 - data_loader - INFO - Found 125 available Fitbit features
2025-10-31 19:05:21,347 - utils - INFO - Performing data quality checks...
2025-10-31 19:05:21,434 - utils - INFO - Data quality check complete. Total subjects: 11115
2025-10-31 19:05:21,434 - utils - INFO - Features with high missing rate: 0
2025-10-31 19:05:21,434 - utils - INFO - Handling missing values using method: drop
2025-10-31 19:05:21,441 - utils - INFO - Dropped rows with missing values. Remaining: 10513
2025-10-31 19:05:21,441 - data_loader - INFO - ================================================================================
2025-10-31 19:05:21,441 - data_loader - INFO - Data preparation complete. Final dataset: 10513 subjects
2025-10-31 19:05:21,441 - data_loader - INFO - ================================================================================
2025-10-31 19:05:21,456 - __main__ - INFO - Loaded dataset: 10513 subjects, 125 features
2025-10-31 19:05:21,457 - __main__ - INFO - Found 2 groups for analysis
2025-10-31 19:05:21,457 - utils - INFO - Performing data quality checks...
2025-10-31 19:05:21,565 - utils - INFO - Data quality check complete. Total subjects: 10513
2025-10-31 19:05:21,565 - utils - INFO - Features with high missing rate: 0
2025-10-31 19:05:21,565 - residualization - INFO - ================================================================================
2025-10-31 19:05:21,565 - residualization - INFO - PHASE 1: RESIDUALIZATION - Removing Covariate Effects
2025-10-31 19:05:21,565 - residualization - INFO - ================================================================================
2025-10-31 19:05:21,570 - residualization - INFO - Using 10099 healthy controls for regression models
2025-10-31 19:05:21,570 - residualization - WARNING - Covariate interview_age not found in dataframe
2025-10-31 19:05:21,570 - residualization - WARNING - Covariate family_income not found in dataframe
2025-10-31 19:05:21,570 - residualization - INFO - Using 0 covariate columns: []
2025-10-31 19:05:21,570 - residualization - INFO - Residualizing 125 features...
2025-10-31 19:05:21,663 - residualization - INFO - Progress: 50/125 features processed
2025-10-31 19:05:21,752 - residualization - INFO - Progress: 100/125 features processed
2025-10-31 19:05:21,804 - residualization - INFO - ================================================================================
2025-10-31 19:05:21,804 - residualization - INFO - Residualization complete:
2025-10-31 19:05:21,804 - residualization - INFO -   Successful: 125 features
2025-10-31 19:05:21,804 - residualization - INFO -   Failed: 0 features
2025-10-31 19:05:21,804 - residualization - INFO - ================================================================================
2025-10-31 19:05:21,809 - residualization - INFO - Residualization statistics saved to residualization_statistics.csv
2025-10-31 19:05:21,810 - residualization - INFO - Validating residualization effectiveness...
2025-10-31 19:05:21,810 - residualization - WARNING - Covariate interview_age not available for validation
2025-10-31 19:05:22,570 - __main__ - INFO - Residualized data saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/residualized_data.csv
2025-10-31 19:05:22,570 - __main__ - INFO - 
Running predictive models with 125 features
2025-10-31 19:05:22,571 - __main__ - WARNING - Group unmedicated_adhd not found in data. Skipping comparison.
2025-10-31 19:05:22,571 - predictive_models - INFO - ================================================================================
2025-10-31 19:05:22,571 - predictive_models - INFO - PHASE 2: PREDICTIVE MODELING
2025-10-31 19:05:22,571 - predictive_models - INFO - Comparing: Healthy Control vs ADHD Stimulant
2025-10-31 19:05:22,571 - predictive_models - INFO - ================================================================================
2025-10-31 19:05:22,571 - predictive_models - INFO - Preparing data for comparison: Group 0 vs Group 2
2025-10-31 19:05:22,582 - predictive_models - INFO - Data prepared: 10513 samples, 125 features
2025-10-31 19:05:22,582 - predictive_models - INFO -   Group 0: 10099 samples
2025-10-31 19:05:22,582 - predictive_models - INFO -   Group 2: 414 samples
2025-10-31 19:05:22,582 - predictive_models - INFO - Class distribution: {0: 10099, 1: 414}
2025-10-31 19:05:22,587 - predictive_models - INFO - Train set: 7359 samples, Test set: 3154 samples
2025-10-31 19:05:22,587 - predictive_models - INFO - Training Logistic Regression model...
2025-10-31 19:05:23,028 - predictive_models - INFO - Logistic Regression Results:
2025-10-31 19:05:23,028 - predictive_models - INFO -   Accuracy: 0.7435
2025-10-31 19:05:23,028 - predictive_models - INFO -   ROC-AUC: 0.8015
2025-10-31 19:05:23,028 - predictive_models - INFO -   CV ROC-AUC: 0.7878 (+/- 0.0281)
2025-10-31 19:05:23,028 - predictive_models - INFO -   Precision: 0.1050
2025-10-31 19:05:23,028 - predictive_models - INFO -   Recall: 0.7339
2025-10-31 19:05:23,028 - predictive_models - INFO -   F1-Score: 0.1837
2025-10-31 19:05:23,028 - predictive_models - INFO - Training Random Forest model...
2025-10-31 19:05:24,783 - predictive_models - INFO - Random Forest Results:
2025-10-31 19:05:24,783 - predictive_models - INFO -   Accuracy: 0.9658
2025-10-31 19:05:24,783 - predictive_models - INFO -   ROC-AUC: 0.9576
2025-10-31 19:05:24,783 - predictive_models - INFO -   CV ROC-AUC: 0.8779 (+/- 0.0413)
2025-10-31 19:05:24,783 - predictive_models - INFO -   Precision: 0.5408
2025-10-31 19:05:24,783 - predictive_models - INFO -   Recall: 0.8548
2025-10-31 19:05:24,783 - predictive_models - INFO -   F1-Score: 0.6625
2025-10-31 19:05:24,783 - predictive_models - INFO - 
================================================================================
2025-10-31 19:05:24,783 - predictive_models - INFO - MODEL COMPARISON SUMMARY
2025-10-31 19:05:24,783 - predictive_models - INFO - ================================================================================
2025-10-31 19:05:24,783 - predictive_models - INFO - Metric               Logistic Reg    Random Forest  
2025-10-31 19:05:24,783 - predictive_models - INFO - --------------------------------------------------------------------------------
2025-10-31 19:05:24,783 - predictive_models - INFO - Accuracy             0.7435          0.9658         
2025-10-31 19:05:24,783 - predictive_models - INFO - ROC-AUC              0.8015          0.9576         
2025-10-31 19:05:24,783 - predictive_models - INFO - Precision            0.1050          0.5408         
2025-10-31 19:05:24,783 - predictive_models - INFO - Recall               0.7339          0.8548         
2025-10-31 19:05:24,783 - predictive_models - INFO - F1-Score             0.1837          0.6625         
2025-10-31 19:05:24,783 - predictive_models - INFO - ================================================================================
2025-10-31 19:05:24,784 - predictive_models - INFO - Creating visualization plots...
2025-10-31 19:05:25,942 - predictive_models - INFO - Plots saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/model_Healthy Control_vs_ADHD Stimulant_results.png
2025-10-31 19:05:25,944 - __main__ - INFO - Results saved for comparison: Healthy Control_vs_ADHD Stimulant
2025-10-31 19:05:25,944 - __main__ - WARNING - Group unmedicated_adhd not found in data. Skipping comparison.
2025-10-31 19:05:25,944 - visualization - INFO - ================================================================================
2025-10-31 19:05:25,944 - visualization - INFO - PHASE 3: PCA ANALYSIS - Visualizing Digital Phenotypes
2025-10-31 19:05:25,944 - visualization - INFO - ================================================================================
2025-10-31 19:05:25,944 - visualization - INFO - Performing PCA with 10 components...
2025-10-31 19:05:25,971 - visualization - INFO - PCA Results:
2025-10-31 19:05:25,971 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC3: 0.0958 variance (0.3859 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC4: 0.0834 variance (0.4693 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC5: 0.0571 variance (0.5264 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC6: 0.0406 variance (0.5669 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC7: 0.0377 variance (0.6047 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC8: 0.0318 variance (0.6365 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC9: 0.0274 variance (0.6639 cumulative)
2025-10-31 19:05:25,971 - visualization - INFO -   PC10: 0.0269 variance (0.6908 cumulative)
2025-10-31 19:05:25,972 - visualization - INFO - Creating scree plot...
2025-10-31 19:05:26,228 - visualization - INFO - Scree plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_scree_plot.png
2025-10-31 19:05:26,228 - visualization - INFO - Performing PCA with 2 components...
2025-10-31 19:05:26,250 - visualization - INFO - PCA Results:
2025-10-31 19:05:26,250 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 19:05:26,250 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 19:05:26,250 - visualization - INFO - Creating 2D PCA plot...
2025-10-31 19:05:26,675 - visualization - INFO - 2D PCA plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_2d_plot.png
2025-10-31 19:05:26,675 - visualization - INFO - Performing PCA with 3 components...
2025-10-31 19:05:26,692 - visualization - INFO - PCA Results:
2025-10-31 19:05:26,692 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 19:05:26,692 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 19:05:26,692 - visualization - INFO -   PC3: 0.0958 variance (0.3859 cumulative)
2025-10-31 19:05:26,693 - visualization - INFO - Creating 3D PCA plot...
2025-10-31 19:05:27,257 - visualization - INFO - 3D PCA plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_3d_plot.png
2025-10-31 19:05:27,257 - visualization - INFO - Creating PCA loading heatmap...
2025-10-31 19:05:27,643 - visualization - INFO - Loading heatmap saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_loadings.png
2025-10-31 19:05:27,643 - visualization - INFO - Testing statistical significance of group separation...
2025-10-31 19:05:27,644 - visualization - INFO - PC1: F=12.3842, p=0.0004
2025-10-31 19:05:27,645 - visualization - INFO - PC2: F=0.0110, p=0.9164
2025-10-31 19:05:27,645 - visualization - INFO - ================================================================================
2025-10-31 19:05:27,645 - visualization - INFO - PCA Analysis Complete
2025-10-31 19:05:27,645 - visualization - INFO - ================================================================================
2025-10-31 19:05:27,645 - __main__ - INFO - 
================================================================================
2025-10-31 19:05:27,645 - __main__ - INFO - GENERATING SUMMARY REPORT
2025-10-31 19:05:27,645 - __main__ - INFO - ================================================================================
2025-10-31 19:05:27,645 - utils - INFO - Summary report created: /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/summary_report.txt
2025-10-31 19:05:27,647 - __main__ - ERROR - Pipeline execution failed: Object of type DataFrame is not JSON serializable
Traceback (most recent call last):
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/main_pipeline.py", line 168, in main
    utils.save_results(summary_results, 'pipeline_results.json')
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/utils.py", line 375, in save_results
    json.dump(results_serializable, f, indent=2, cls=NumpyEncoder) # <-- Add cls=NumpyEncoder
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/__init__.py", line 179, in dump
    for chunk in iterable:
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 431, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  [Previous line repeated 1 more time]
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 438, in _iterencode
    o = _default(o)
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/utils.py", line 55, in default
    return super(NumpyEncoder, self).default(obj)
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type DataFrame is not JSON serializable
2025-10-31 19:05:27,648 - __main__ - ERROR - Pipeline failed with error
2025-10-31 19:06:18,706 - __main__ - INFO - ================================================================================
2025-10-31 19:06:18,706 - __main__ - INFO - ADHD DIGITAL PHENOTYPE ANALYSIS PIPELINE
2025-10-31 19:06:18,706 - __main__ - INFO - Started at: 2025-10-31 19:06:18
2025-10-31 19:06:18,707 - __main__ - INFO - ================================================================================
2025-10-31 19:06:18,707 - __main__ - INFO - 
================================================================================
2025-10-31 19:06:18,707 - __main__ - INFO - PHASE 0: DATA LOADING AND PREPARATION
2025-10-31 19:06:18,707 - __main__ - INFO - ================================================================================
2025-10-31 19:06:18,707 - data_loader - INFO - ================================================================================
2025-10-31 19:06:18,707 - data_loader - INFO - Starting data loading and preparation
2025-10-31 19:06:18,707 - data_loader - INFO - ================================================================================
2025-10-31 19:06:18,707 - data_loader - INFO - Loading Fitbit data from /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/fitbit_data.xlsx
2025-10-31 19:06:18,782 - data_loader - INFO - Found 14 sheets: ['NC Controls', 'ADHD_preprocessed', 'ADHD_Unmedicated', 'ADHD_Stimulants', 'ADHD_NonStimulants', 'ABCD_Methylphenidate_only', 'ADHD_Amphetamine_Only', 'ADHD_Lisdexamfetamine_Only', 'ADHD_Guanfacine_Only', 'ADHD_Atomoxetine_Only', 'ADHD_Dexmethylphenidate_Only', 'HR_explained', 'ADHD_OLD', 'ADHD_Medicated_OLD']
2025-10-31 19:06:18,782 - data_loader - INFO - Loading sheet: NC Controls
2025-10-31 19:06:20,724 - data_loader - INFO -   Assigned as Control group: 2238 subjects
2025-10-31 19:06:20,724 - data_loader - INFO - Loading sheet: ADHD_preprocessed
2025-10-31 19:06:21,005 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_preprocessed', defaulting to control
2025-10-31 19:06:21,005 - data_loader - INFO - Loading sheet: ADHD_Unmedicated
2025-10-31 19:06:21,139 - data_loader - INFO -   Assigned as Unmedicated ADHD: 143 subjects
2025-10-31 19:06:21,139 - data_loader - INFO - Loading sheet: ADHD_Stimulants
2025-10-31 19:06:21,277 - data_loader - INFO -   Assigned as Stimulant ADHD: 110 subjects
2025-10-31 19:06:21,277 - data_loader - INFO - Loading sheet: ADHD_NonStimulants
2025-10-31 19:06:21,316 - data_loader - INFO -   Assigned as Stimulant ADHD: 15 subjects
2025-10-31 19:06:21,316 - data_loader - INFO - Loading sheet: ABCD_Methylphenidate_only
2025-10-31 19:06:21,346 - data_loader - WARNING -   Could not determine group for sheet 'ABCD_Methylphenidate_only', defaulting to control
2025-10-31 19:06:21,346 - data_loader - INFO - Loading sheet: ADHD_Amphetamine_Only
2025-10-31 19:06:21,375 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Amphetamine_Only', defaulting to control
2025-10-31 19:06:21,375 - data_loader - INFO - Loading sheet: ADHD_Lisdexamfetamine_Only
2025-10-31 19:06:21,402 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Lisdexamfetamine_Only', defaulting to control
2025-10-31 19:06:21,403 - data_loader - INFO - Loading sheet: ADHD_Guanfacine_Only
2025-10-31 19:06:21,430 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Guanfacine_Only', defaulting to control
2025-10-31 19:06:21,430 - data_loader - INFO - Loading sheet: ADHD_Atomoxetine_Only
2025-10-31 19:06:21,458 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Atomoxetine_Only', defaulting to control
2025-10-31 19:06:21,458 - data_loader - INFO - Loading sheet: ADHD_Dexmethylphenidate_Only
2025-10-31 19:06:21,517 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Dexmethylphenidate_Only', defaulting to control
2025-10-31 19:06:21,517 - data_loader - INFO - Loading sheet: HR_explained
2025-10-31 19:06:21,544 - data_loader - WARNING -   Could not determine group for sheet 'HR_explained', defaulting to control
2025-10-31 19:06:21,544 - data_loader - INFO - Loading sheet: ADHD_OLD
2025-10-31 19:06:21,599 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_OLD', defaulting to control
2025-10-31 19:06:21,599 - data_loader - INFO - Loading sheet: ADHD_Medicated_OLD
2025-10-31 19:06:21,637 - data_loader - WARNING -   Could not determine group for sheet 'ADHD_Medicated_OLD', defaulting to control
2025-10-31 19:06:21,656 - data_loader - INFO - Successfully loaded 3404 total rows from 14 sheets
2025-10-31 19:06:21,657 - data_loader - INFO - Group distribution after loading:
2025-10-31 19:06:21,657 - data_loader - INFO -   Healthy Control: 3136
2025-10-31 19:06:21,657 - data_loader - INFO -   ADHD Unmedicated: 143
2025-10-31 19:06:21,657 - data_loader - INFO -   ADHD Stimulant: 125
2025-10-31 19:06:21,657 - data_loader - INFO - Loading medication data from /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/medsy01.xlsx
2025-10-31 19:06:31,333 - data_loader - INFO - Successfully loaded 39766 medication records
2025-10-31 19:06:31,334 - data_loader - INFO - Creating medication group classifications
2025-10-31 19:06:36,889 - data_loader - INFO - Medication groups: {'none': 36749, 'stimulant': 3017}
2025-10-31 19:06:36,943 - data_loader - INFO - Merging datasets and creating analysis groups
2025-10-31 19:06:36,967 - data_loader - WARNING - No 'adhd_diagnosis' column found. Inferring groups from medication only.
2025-10-31 19:06:36,968 - data_loader - INFO - Analysis group distribution:
2025-10-31 19:06:36,968 - data_loader - INFO -   Healthy Control: 10701
2025-10-31 19:06:36,968 - data_loader - INFO -   ADHD Stimulant: 414
2025-10-31 19:06:36,968 - data_loader - INFO - Preparing covariates
2025-10-31 19:06:36,970 - data_loader - WARNING - Missing covariates: ['interview_age', 'sex', 'family_income', 'race_eth_cat']
2025-10-31 19:06:36,970 - data_loader - INFO - Found 125 available Fitbit features
2025-10-31 19:06:36,970 - utils - INFO - Performing data quality checks...
2025-10-31 19:06:37,043 - utils - INFO - Data quality check complete. Total subjects: 11115
2025-10-31 19:06:37,044 - utils - INFO - Features with high missing rate: 0
2025-10-31 19:06:37,044 - utils - INFO - Handling missing values using method: drop
2025-10-31 19:06:37,050 - utils - INFO - Dropped rows with missing values. Remaining: 10513
2025-10-31 19:06:37,050 - data_loader - INFO - ================================================================================
2025-10-31 19:06:37,050 - data_loader - INFO - Data preparation complete. Final dataset: 10513 subjects
2025-10-31 19:06:37,050 - data_loader - INFO - ================================================================================
2025-10-31 19:06:37,059 - __main__ - INFO - Loaded dataset: 10513 subjects, 125 features
2025-10-31 19:06:37,059 - __main__ - INFO - Found 2 groups for analysis
2025-10-31 19:06:37,059 - utils - INFO - Performing data quality checks...
2025-10-31 19:06:37,161 - utils - INFO - Data quality check complete. Total subjects: 10513
2025-10-31 19:06:37,161 - utils - INFO - Features with high missing rate: 0
2025-10-31 19:06:37,161 - residualization - INFO - ================================================================================
2025-10-31 19:06:37,161 - residualization - INFO - PHASE 1: RESIDUALIZATION - Removing Covariate Effects
2025-10-31 19:06:37,162 - residualization - INFO - ================================================================================
2025-10-31 19:06:37,167 - residualization - INFO - Using 10099 healthy controls for regression models
2025-10-31 19:06:37,167 - residualization - WARNING - Covariate interview_age not found in dataframe
2025-10-31 19:06:37,167 - residualization - WARNING - Covariate family_income not found in dataframe
2025-10-31 19:06:37,167 - residualization - INFO - Using 0 covariate columns: []
2025-10-31 19:06:37,167 - residualization - INFO - Residualizing 125 features...
2025-10-31 19:06:37,262 - residualization - INFO - Progress: 50/125 features processed
2025-10-31 19:06:37,355 - residualization - INFO - Progress: 100/125 features processed
2025-10-31 19:06:37,409 - residualization - INFO - ================================================================================
2025-10-31 19:06:37,409 - residualization - INFO - Residualization complete:
2025-10-31 19:06:37,409 - residualization - INFO -   Successful: 125 features
2025-10-31 19:06:37,409 - residualization - INFO -   Failed: 0 features
2025-10-31 19:06:37,409 - residualization - INFO - ================================================================================
2025-10-31 19:06:37,413 - residualization - INFO - Residualization statistics saved to residualization_statistics.csv
2025-10-31 19:06:37,414 - residualization - INFO - Validating residualization effectiveness...
2025-10-31 19:06:37,414 - residualization - WARNING - Covariate interview_age not available for validation
2025-10-31 19:06:38,167 - __main__ - INFO - Residualized data saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/residualized_data.csv
2025-10-31 19:06:38,168 - __main__ - INFO - 
Running predictive models with 125 features
2025-10-31 19:06:38,168 - __main__ - WARNING - Group unmedicated_adhd not found in data. Skipping comparison.
2025-10-31 19:06:38,168 - predictive_models - INFO - ================================================================================
2025-10-31 19:06:38,168 - predictive_models - INFO - PHASE 2: PREDICTIVE MODELING
2025-10-31 19:06:38,168 - predictive_models - INFO - Comparing: Healthy Control vs ADHD Stimulant
2025-10-31 19:06:38,168 - predictive_models - INFO - ================================================================================
2025-10-31 19:06:38,168 - predictive_models - INFO - Preparing data for comparison: Group 0 vs Group 2
2025-10-31 19:06:38,179 - predictive_models - INFO - Data prepared: 10513 samples, 125 features
2025-10-31 19:06:38,179 - predictive_models - INFO -   Group 0: 10099 samples
2025-10-31 19:06:38,179 - predictive_models - INFO -   Group 2: 414 samples
2025-10-31 19:06:38,180 - predictive_models - INFO - Class distribution: {0: 10099, 1: 414}
2025-10-31 19:06:38,184 - predictive_models - INFO - Train set: 7359 samples, Test set: 3154 samples
2025-10-31 19:06:38,184 - predictive_models - INFO - Training Logistic Regression model...
2025-10-31 19:06:38,610 - predictive_models - INFO - Logistic Regression Results:
2025-10-31 19:06:38,610 - predictive_models - INFO -   Accuracy: 0.7435
2025-10-31 19:06:38,610 - predictive_models - INFO -   ROC-AUC: 0.8015
2025-10-31 19:06:38,610 - predictive_models - INFO -   CV ROC-AUC: 0.7878 (+/- 0.0281)
2025-10-31 19:06:38,610 - predictive_models - INFO -   Precision: 0.1050
2025-10-31 19:06:38,610 - predictive_models - INFO -   Recall: 0.7339
2025-10-31 19:06:38,610 - predictive_models - INFO -   F1-Score: 0.1837
2025-10-31 19:06:38,610 - predictive_models - INFO - Training Random Forest model...
2025-10-31 19:06:40,392 - predictive_models - INFO - Random Forest Results:
2025-10-31 19:06:40,392 - predictive_models - INFO -   Accuracy: 0.9658
2025-10-31 19:06:40,392 - predictive_models - INFO -   ROC-AUC: 0.9576
2025-10-31 19:06:40,392 - predictive_models - INFO -   CV ROC-AUC: 0.8779 (+/- 0.0413)
2025-10-31 19:06:40,392 - predictive_models - INFO -   Precision: 0.5408
2025-10-31 19:06:40,392 - predictive_models - INFO -   Recall: 0.8548
2025-10-31 19:06:40,392 - predictive_models - INFO -   F1-Score: 0.6625
2025-10-31 19:06:40,392 - predictive_models - INFO - 
================================================================================
2025-10-31 19:06:40,392 - predictive_models - INFO - MODEL COMPARISON SUMMARY
2025-10-31 19:06:40,392 - predictive_models - INFO - ================================================================================
2025-10-31 19:06:40,392 - predictive_models - INFO - Metric               Logistic Reg    Random Forest  
2025-10-31 19:06:40,392 - predictive_models - INFO - --------------------------------------------------------------------------------
2025-10-31 19:06:40,392 - predictive_models - INFO - Accuracy             0.7435          0.9658         
2025-10-31 19:06:40,392 - predictive_models - INFO - ROC-AUC              0.8015          0.9576         
2025-10-31 19:06:40,392 - predictive_models - INFO - Precision            0.1050          0.5408         
2025-10-31 19:06:40,392 - predictive_models - INFO - Recall               0.7339          0.8548         
2025-10-31 19:06:40,393 - predictive_models - INFO - F1-Score             0.1837          0.6625         
2025-10-31 19:06:40,393 - predictive_models - INFO - ================================================================================
2025-10-31 19:06:40,393 - predictive_models - INFO - Creating visualization plots...
2025-10-31 19:06:41,561 - predictive_models - INFO - Plots saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/model_Healthy Control_vs_ADHD Stimulant_results.png
2025-10-31 19:06:41,563 - __main__ - INFO - Results saved for comparison: Healthy Control_vs_ADHD Stimulant
2025-10-31 19:06:41,563 - __main__ - WARNING - Group unmedicated_adhd not found in data. Skipping comparison.
2025-10-31 19:06:41,563 - visualization - INFO - ================================================================================
2025-10-31 19:06:41,563 - visualization - INFO - PHASE 3: PCA ANALYSIS - Visualizing Digital Phenotypes
2025-10-31 19:06:41,563 - visualization - INFO - ================================================================================
2025-10-31 19:06:41,563 - visualization - INFO - Performing PCA with 10 components...
2025-10-31 19:06:41,594 - visualization - INFO - PCA Results:
2025-10-31 19:06:41,594 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC3: 0.0958 variance (0.3859 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC4: 0.0834 variance (0.4693 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC5: 0.0571 variance (0.5264 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC6: 0.0406 variance (0.5669 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC7: 0.0377 variance (0.6047 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC8: 0.0318 variance (0.6365 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC9: 0.0274 variance (0.6639 cumulative)
2025-10-31 19:06:41,594 - visualization - INFO -   PC10: 0.0269 variance (0.6908 cumulative)
2025-10-31 19:06:41,595 - visualization - INFO - Creating scree plot...
2025-10-31 19:06:41,846 - visualization - INFO - Scree plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_scree_plot.png
2025-10-31 19:06:41,846 - visualization - INFO - Performing PCA with 2 components...
2025-10-31 19:06:41,865 - visualization - INFO - PCA Results:
2025-10-31 19:06:41,865 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 19:06:41,865 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 19:06:41,865 - visualization - INFO - Creating 2D PCA plot...
2025-10-31 19:06:42,286 - visualization - INFO - 2D PCA plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_2d_plot.png
2025-10-31 19:06:42,286 - visualization - INFO - Performing PCA with 3 components...
2025-10-31 19:06:42,305 - visualization - INFO - PCA Results:
2025-10-31 19:06:42,305 - visualization - INFO -   PC1: 0.1625 variance (0.1625 cumulative)
2025-10-31 19:06:42,305 - visualization - INFO -   PC2: 0.1276 variance (0.2901 cumulative)
2025-10-31 19:06:42,305 - visualization - INFO -   PC3: 0.0958 variance (0.3859 cumulative)
2025-10-31 19:06:42,305 - visualization - INFO - Creating 3D PCA plot...
2025-10-31 19:06:42,860 - visualization - INFO - 3D PCA plot saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_3d_plot.png
2025-10-31 19:06:42,860 - visualization - INFO - Creating PCA loading heatmap...
2025-10-31 19:06:43,249 - visualization - INFO - Loading heatmap saved to /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/pca_loadings.png
2025-10-31 19:06:43,249 - visualization - INFO - Testing statistical significance of group separation...
2025-10-31 19:06:43,251 - visualization - INFO - PC1: F=12.3842, p=0.0004
2025-10-31 19:06:43,251 - visualization - INFO - PC2: F=0.0110, p=0.9164
2025-10-31 19:06:43,251 - visualization - INFO - ================================================================================
2025-10-31 19:06:43,251 - visualization - INFO - PCA Analysis Complete
2025-10-31 19:06:43,251 - visualization - INFO - ================================================================================
2025-10-31 19:06:43,251 - __main__ - INFO - 
================================================================================
2025-10-31 19:06:43,251 - __main__ - INFO - GENERATING SUMMARY REPORT
2025-10-31 19:06:43,251 - __main__ - INFO - ================================================================================
2025-10-31 19:06:43,252 - utils - INFO - Summary report created: /Users/guozhenghui/Desktop/WXY/ComBio/ABCD/analysis_output/summary_report.txt
2025-10-31 19:06:43,256 - __main__ - ERROR - Pipeline execution failed: Object of type DataFrame is not JSON serializable
Traceback (most recent call last):
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/main_pipeline.py", line 170, in main
    utils.save_results(summary_results, 'pipeline_results.json')
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/utils.py", line 375, in save_results
    json.dump(results_serializable, f, indent=2, cls=NumpyEncoder) # <-- Add cls=NumpyEncoder
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/__init__.py", line 179, in dump
    for chunk in iterable:
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 431, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 405, in _iterencode_dict
    yield from chunks
  [Previous line repeated 1 more time]
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 438, in _iterencode
    o = _default(o)
  File "/Users/guozhenghui/Desktop/WXY/ComBio/ABCD/utils.py", line 55, in default
    return super(NumpyEncoder, self).default(obj)
  File "/opt/miniconda3/envs/bioinfo/lib/python3.9/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type DataFrame is not JSON serializable
2025-10-31 19:06:43,257 - __main__ - ERROR - Pipeline failed with error
